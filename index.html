<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Warhammer 40k List Compactor</title>
    <link rel="stylesheet" href="styles.css?v=0.0.8">
</head>
<body>
    <div id="app"></div>

    <div class="container">
        <div class="card">
            <header class="header">
                <h1>Warhammer 40k List Compactor</h1>
                <p>Paste your army list from the GW App or in WTC-Compact format below. The tool will generate a full version and a compact, Discord-friendly version.</p>
            </header>

            <!-- App Footer with Contact Info -->
            <footer class="app-footer">
                <p>For feedback or questions, reach out to <a href="https://discord.com/users/Desjani" target="_blank">@Desjani</a> on Discord.</p>
            </footer>

            <div class="grid-container-two-col">
                <!-- Input Column -->
                <div>
                    <label for="inputText" class="io-label">Paste List here (GW App or WTC-Compact)</label>
                    <textarea id="inputText" class="io-box" autofocus></textarea>
                    <div class="column-footer" style="flex-direction: column; align-items: center;">
                        <div id="inputCharCount" class="char-count" style="margin-bottom: 0.5rem;"></div>
                        <div class="button-group">
                            <button id="resetButton" class="btn btn-danger">Start Over</button>
                            <button id="parseButton" class="btn btn-primary">Compact this list</button>
                        </div>
                    </div>
                </div>

                <!-- Dropdowns Column -->
                <div class="dropdowns-column">
                    <h3 class="io-label">List Options</h3>
                    <div class="options-box">
                    <div style="margin-bottom: 0.5rem;">
                        <label>List Style: 
                            <select id="outputFormatSelect">
                                <option value="discordCompact">Discord (Compact)</option>
                                <option value="discordExtended">Discord (Extended)</option>
                                <option value="plainText">Plain Text</option>
                                <option value="plainTextExtended">Plain Text (extended)</option>
                            </select>
                        </label>
                    </div>
                    <div style="margin-bottom: 0.5rem;">
                        <label>
                            Hide Subunits <input type="checkbox" id="hideSubunitsCheckbox">
                        </label>
                    </div>
                    <div style="margin-bottom: 0.5rem;">
                        <label>
                            Multiline Header <input type="checkbox" id="multilineHeaderCheckbox">
                        </label>
                    </div>
                    <!-- Color Options Section -->
                    <div class="color-options-container" style="margin-top: 1rem; text-align: center;">
                        <div class="color-options">
                            <label><input type="radio" name="colorMode" value="faction" checked> Faction Colors</label>
                            <label><input type="radio" name="colorMode" value="none"> No Color</label>
                            <label><input type="radio" name="colorMode" value="custom"> Custom Colors</label>
                        </div>
                        <div id="customColorPickers" style="margin-top: 0.5rem; text-align: center;">
                            <div style="margin-bottom: 0.5rem;">
                                <label>Header: 
                                    <select id="headerColor">
                                        <option value="#FFFFFF" selected>White</option>
                                        <option value="#808080">Grey</option>
                                        <option value="#FF0000">Red</option>
                                        <option value="#00FF00">Green</option>
                                        <option value="#FFFF00">Yellow</option>
                                        <option value="#0000FF">Blue</option>
                                        <option value="#FF00FF">Magenta</option>
                                        <option value="#00FFFF">Cyan</option>
                                    </select>
                                </label>
                            </div>
                            <div style="margin-bottom: 0.5rem;">
                                <label>Unit: 
                                    <select id="unitColor">
                                        <option value="#FFFFFF">White</option>
                                        <option value="#808080">Grey</option>
                                        <option value="#FF0000" selected>Red</option>
                                        <option value="#00FF00">Green</option>
                                        <option value="#FFFF00">Yellow</option>
                                        <option value="#0000FF">Blue</option>
                                        <option value="#FF00FF">Magenta</option>
                                        <option value="#00FFFF">Cyan</option>
                                    </select>
                                </label>
                            </div>
                            <div style="margin-bottom: 0.5rem;">
                                <label>Subunit: 
                                    <select id="subunitColor">
                                        <option value="#FFFFFF">White</option>
                                        <option value="#808080" selected>Grey</option>
                                        <option value="#FF0000">Red</option>
                                        <option value="#00FF00">Green</option>
                                        <option value="#FFFF00">Yellow</option>
                                        <option value="#0000FF">Blue</option>
                                        <option value="#FF00FF">Magenta</option>
                                        <option value="#00FFFF">Cyan</option>
                                    </select>
                                </label>
                            </div>
                            <div style="margin-bottom: 0.5rem;">
                                <label>Wargear: 
                                    <select id="wargearColor">
                                        <option value="#FFFFFF" selected>White</option>
                                        <option value="#808080">Grey</option>
                                        <option value="#FF0000">Red</option>
                                        <option value="#00FF00">Green</option>
                                        <option value="#FFFF00">Yellow</option>
                                        <option value="#0000FF">Blue</option>
                                        <option value="#FF00FF">Magenta</option>
                                        <option value="#00FFFF">Cyan</option>
                                    </select>
                                </label>
                            </div>
                            <div style="margin-bottom: 0.5rem;">
                                <label>Points: 
                                    <select id="pointsColor">
                                        <option value="#FFFFFF">White</option>
                                        <option value="#808080">Grey</option>
                                        <option value="#FF0000">Red</option>
                                        <option value="#00FF00">Green</option>
                                        <option value="#FFFF00" selected>Yellow</option>
                                        <option value="#0000FF">Blue</option>
                                        <option value="#FF00FF">Magenta</option>
                                        <option value="#00FFFF">Cyan</option>
                                    </select>
                                </label>
                            </div>
                        </div>
                    </div>
                    <!-- close options-box -->
                    </div>
                </div>
            </div>

            <div class="grid-container-two-col" style="margin-top: 1.5rem;">
                <!-- Extended Output Column -->
                <div>
                    <label for="unabbreviatedOutput" class="io-label">Full Text</label>
                    <div id="unabbreviatedOutput" class="io-box"></div>
                     <div class="column-footer" style="flex-direction: column; align-items: center;">
                        <div id="extendedCharCount" class="char-count" style="margin-bottom: 0.5rem;"></div>
                        <button id="copyExtendedButton" class="btn btn-copy">Copy Full Text to Clipboard</button>
                    </div>
                </div>

                <!-- Discord Preview Column -->
                <div>
                    <label for="markdownPreviewOutput" class="io-label">Compacted Preview</label>
                    <div id="markdownPreviewOutput" class="io-box markdown-preview"></div>
                    <div class="column-footer" style="flex-direction: column; align-items: center;">
                        <div id="markdownPreviewCharCount" class="char-count" style="margin-bottom: 0.5rem;"></div>
                        <button id="copyPreviewButton" class="btn btn-copy">Copy Preview to Clipboard</button>
                    </div>
                    <div id="factionColorDiagnostic" style="margin-top:0.5rem;font-size:0.75rem;color:var(--color-text-secondary);"></div>
                </div>
            </div>

            <!-- Changelog and Roadmap Section -->
            <div class="changelog-section">
                <div class="changelog-entry roadmap">
                    <h4>Roadmap</h4>
                    <ul>
                        <li>.ROSZ file format support</li>
                        <li>Mobile-friendly version</li>
                        <li>Individual faction compacting rule adjustments (skippable wargear)</li>
                        <li>Ongoing bugfixes and performance improvements</li>
                    </ul>
                </div>
                <div class="changelog-entry">
                    <h4>Changelog</h4>
                    <div class="changelog-version-entry">
                        <h5>Version 1.1.1: Thats not a wargear, that's my wife!</h5>
                        <p>Minor parser and rendering fixes.</p>
                    </div>
                    <div class="changelog-version-entry">
                        <h5>Version 1.0.0: TOTAL OVERHAUL!</h5>
                        <ul>
                            <li>Completely re-architected the application for improved performance, maintainability, and future expansion.</li>
                            <li>Introduced a new modular structure for better code organization.</li>
                            <li>Enhanced parsing capabilities for even more robust list processing.</li>
                            <li>Improved UI responsiveness and user experience.</li>
                            <li>Added "Multiline Header" option for flexible output formatting.</li>
                            <li>Added "Side Subunits" option for even more compact output.</li>
                            <li>Fixed various bugs and improved overall stability.</li>
                        </ul>
                    </div>
                    <div class="changelog-version-entry">
                        <h5>Version 0.1.2: Internal Updates</h5>
                        <ul>
                            <li>Rolled back some experimental changes to ensure stability.</li>
                            <li>Internal updates and stability improvements.</li>
                        </ul>
                    </div>
                    <div class="changelog-version-entry">
                        <h5>Version 0.1.1: The Ordo Spellcheck would like a word...</h5>
                        <ul>
                            <li>Separated "Points/Header" color option into two distinct settings: "Points" and "Header".</li>
                            <li>Added a new color option for "Wargear" to customize its appearance in the output.</li>
                            <li>Set the default color scheme to "Custom Colors" and adjusted the default color values for better readability.</li>
                            <li>Rearranged the color picker order for a more logical workflow.</li>
                            <li>Corrected a bunch of typos for all Imperium (non-Space Marine) factions.</li>
                            <li>Updated Grey Knights to match new codex.</li>
                            <li>Fixed a bug where wargear items were incorrectly displayed as "[object Object]" in the compact list view.</li>
                        </ul>
                    </div>
                    <div class="changelog-version-entry">
                        <h5>Version 0.1.0 - The 'No List Left Behind' Update</h5>
                        <ul>
                            <li><b>Overhauled GW App Parser:</b> The parser is now significantly more robust and can handle a much wider variety of list formats and quirks.</li>
                            <li><b>Flexible Header Parsing:</b> Correctly identifies the List Title, Faction, Detachment, and Points, even if they appear in a different order.</li>
                            <li><b>Smarter Wargear Detection:</b> Improved logic for identifying sub-units (like squad leaders) and their wargear, leading to more accurate compacting.</li>
                            <li><b>Intelligent Name Matching:</b> The abbreviation engine now smartly handles plural vs. singular unit names (e.g., "Piranha" vs. "Piranhas").</li>
                            <li><b>Expanded Format Support:</b> Now correctly parses point values with separators (e.g., "2,000") and more types of bullet points (•, -, ◦).</li>
                        </ul>
                    </div>
                    <div class="changelog-version-entry">
                        <h5>Version 0.0.5: Modulation Mambo</h5>
                        <p>Refactored JavaScript into modular components for better organization and maintainability.</p>
                    </div>
                    <div class="changelog-version-entry">
                        <h5>Version 0.0.4: T'au Season!</h5>
                        <p>Numerous parser fixes and improved wargear filtering for T'au Empire lists to prevent redundant items from appearing in the compact list.</p>
                    </div>
                    <div class="changelog-version-entry">
                        <h5>Version 0.0.3: Fixes, Formatting, and more!</h5>
                        <p>Implemented a new inline compact format for easier reading. Added more 'Copy for Discord' options for greater flexibility. Numerous parser fixes for both GW App and WTC-Compact formats to improve reliability.</p>
                    </div>
                    <div class="changelog-version-entry">
                        <h5>Version 0.0.2: Support for GW App and WTC-Compact formats</h5>
                        <p>The parser now supports both major list formats, with improved reliability for complex nested units and wargear. Abbreviation logic is now consistent across both formats.</p>
                    </div>
                    <div class="changelog-version-entry">
                        <h5>Version 0.0.1: Initial Beta Release</h5>
                        <p>The first version is live! Basic list parsing and abbreviation for most major factions is included. More features and polish to come.</p>
                    </div>
                </div>
            </div>

            <!-- Debug Toggle and Output Section -->
            <div style="text-align: center; margin-top: 1.5rem;">
                <button id="toggleDebugButton" class="btn" style="background-color: black; color: white; border: 1px solid #444;">Show Debug Log</button>
            </div>

            <div id="debugContainer" class="changelog-section" style="margin-top: 0.5rem; display: none;">
                <div class="changelog-entry">
                    <h4>Debug Log</h4>
                    <div id="debugOutput" class="io-box" style="max-height: 200px; overflow-y: auto; background-color: #282c34; color: #abb2bf; font-family: monospace; font-size: 0.75rem; line-height: 1.4;"></div>
                </div>
            </div>

        </div>
    </div>

    <div id="copyPopup" class="copy-popup">Copied to Clipboard!</div>

    <script src="https://cdn.jsdelivr.net/npm/ansi_up@5.1.0/ansi_up.min.js"></script>
    <script type="module" src="./modules/main.js"></script>

</body>
</html>